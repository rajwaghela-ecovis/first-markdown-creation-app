# PROJ-4: Documentation Viewer & Export

## Status: ðŸ”µ Planned

## Overview
Provide a beautiful online documentation viewer with markdown rendering, syntax highlighting, and export options (view online, download as files, or commit back to repository).

## Dependencies
- **Requires:** PROJ-1 (Repository Connection & Authentication) - for repo access
- **Requires:** PROJ-3 (AI-Powered Documentation Generator) - for generated docs

## User Stories

### As a developer viewing documentation
- I want to see my generated documentation in a clean, readable format
- I want syntax highlighting for code blocks
- I want a table of contents for easy navigation
- I want to search within the documentation
- I want to view documentation on mobile devices
- I want to share a public link to my documentation

### As a developer exporting documentation
- I want to download all documentation as markdown files
- I want to commit documentation back to my repository (in /docs folder)
- I want to choose which sections to export
- I want to preserve markdown formatting in exported files

### As a team member collaborating
- I want to view documentation without logging in (if made public)
- I want to see when documentation was last updated
- I want to print documentation as PDF
- I want to copy code snippets with one click

## Acceptance Criteria

### Documentation Viewer
- [ ] Documentation renders in clean, readable layout
- [ ] Code blocks have syntax highlighting (JavaScript, Python, etc.)
- [ ] Markdown is properly rendered (headings, lists, tables, links)
- [ ] Mermaid diagrams are rendered (for architecture docs)
- [ ] Table of contents is auto-generated from headings
- [ ] Clicking TOC items scrolls to relevant section
- [ ] Search functionality highlights matching text
- [ ] Mobile-responsive design (readable on phones/tablets)

### Navigation & UX
- [ ] Sidebar shows all documentation sections (Overview, Architecture, API, etc.)
- [ ] Active section is highlighted in sidebar
- [ ] Smooth scrolling between sections
- [ ] "Back to top" button appears when scrolling down
- [ ] Breadcrumb navigation (Home > Projects > Project Name > Documentation)
- [ ] "Edit" button to regenerate specific sections

### Code Block Features
- [ ] Syntax highlighting for 20+ languages
- [ ] "Copy to clipboard" button on each code block
- [ ] Line numbers for code blocks > 10 lines
- [ ] Code block language label (e.g., "TypeScript", "Bash")
- [ ] Wrap/unwrap long lines toggle

### Export Options
- [ ] **View Online** - Default view in app
- [ ] **Download as ZIP** - All markdown files in organized folders
- [ ] **Commit to Repository** - Push docs to /docs folder in repo
- [ ] User can select which sections to export (checkboxes)
- [ ] User can choose export folder name (default: "docs")
- [ ] Export includes a generated README.md with links to all sections

### Download as ZIP
- [ ] ZIP file named: `{repo-name}-docs-{date}.zip`
- [ ] Folder structure: `/docs/overview.md`, `/docs/architecture.md`, etc.
- [ ] Includes a main README.md with table of contents
- [ ] Download starts immediately (no waiting)
- [ ] File size shown before download

### Commit to Repository
- [ ] User can choose target branch (default: main)
- [ ] User can choose docs folder path (default: /docs)
- [ ] System creates commit with message: "docs: Add AI-generated documentation"
- [ ] System shows commit SHA and link to view on GitHub/GitLab
- [ ] If /docs folder exists, user is asked: "Overwrite existing docs?"
- [ ] User can preview changes before committing (diff view)

### Sharing & Permissions
- [ ] User can make documentation public (shareable link)
- [ ] Public documentation has unique URL: `app.com/docs/{unique-id}`
- [ ] User can revoke public access anytime
- [ ] Public docs show "Generated by [App Name]" footer
- [ ] Private docs require login to view

### Print & PDF Export
- [ ] "Print" button generates print-friendly layout
- [ ] Page breaks at section boundaries
- [ ] No sidebar/navigation in print view
- [ ] Table of contents included on first page
- [ ] Footer with page numbers and project name

## Edge Cases

### Rendering Issues
- **What happens if markdown contains invalid syntax?**
  - Render as much as possible
  - Show warning: "Some markdown syntax may not render correctly"
  - Provide "Report issue" button

- **What happens if code block language is not supported?**
  - Render as plain text (no syntax highlighting)
  - Still show "Copy" button
  - Log unsupported language for future support

### Export Failures
- **What happens if commit to repository fails (no permissions)?**
  - Show error: "Failed to commit. Check repository permissions."
  - Offer alternative: "Download as ZIP instead"
  - Provide instructions to add write permissions

- **What happens if repository branch doesn't exist?**
  - Show error: "Branch '{branch}' not found"
  - List available branches
  - Offer to create new branch

### Large Documentation
- **What happens if documentation is > 10MB?**
  - Show warning: "Large documentation. Download may take a moment."
  - Use streaming download (don't load entire file in memory)
  - Show download progress bar

- **What happens if documentation has 100+ sections?**
  - Paginate table of contents (show 20 at a time)
  - Add search to TOC
  - Group related sections (collapsible groups)

### Network Issues
- **What happens if user loses internet while viewing docs?**
  - Cache documentation in browser (Service Worker)
  - Show offline indicator
  - Allow viewing cached docs offline

- **What happens if commit fails due to network timeout?**
  - Retry up to 3 times
  - If still failing, save commit data locally
  - Offer manual retry button

### Sharing & Access
- **What happens if someone accesses a revoked public link?**
  - Show 404 page: "Documentation not found or no longer public"
  - Suggest contacting the owner

- **What happens if user tries to view someone else's private docs?**
  - Show 403 page: "Access denied. This documentation is private."
  - Offer login option

### Empty Documentation
- **What happens if no documentation was generated yet?**
  - Show empty state: "No documentation available"
  - Show "Generate Documentation" button
  - Provide quick start guide

## Technical Requirements

### Performance
- Documentation page loads in < 2 seconds
- Search results appear in < 500ms
- Smooth scrolling (60fps)
- Code highlighting renders in < 100ms per block

### Markdown Rendering
- Use `react-markdown` or `marked` library
- Support GitHub Flavored Markdown (GFM)
- Support Mermaid diagrams (`mermaid-js`)
- Support math equations (KaTeX) - optional

### Syntax Highlighting
- Use `highlight.js` or `prism.js`
- Support languages: JavaScript, TypeScript, Python, Java, Go, Rust, PHP, Ruby, C++, SQL, Bash, YAML, JSON, Markdown
- Theme: GitHub Light (matches GitHub style)
- Dark mode support (future)

### Export Implementation
- ZIP generation: Use `jszip` library
- File download: Use browser download API
- Commit to repo: Use GitHub/GitLab API
- Preview diff: Use `diff` library

### UI Components (shadcn/ui)
- Button (for export, copy, etc.)
- Tabs (for switching between sections)
- Sidebar (for navigation)
- Dialog (for export options)
- Toast (for success/error messages)
- Skeleton (for loading states)

### Data Storage (Supabase)
```sql
-- documentation_shares table
- id (uuid, primary key)
- documentation_id (uuid, foreign key to generated_documentation)
- share_token (text, unique) -- for public URLs
- is_public (boolean)
- view_count (integer, default 0)
- created_at (timestamp)
- expires_at (timestamp, nullable)
- revoked_at (timestamp, nullable)
```

## Dependencies
- **Requires:** PROJ-1 (Repository Connection & Authentication)
- **Requires:** PROJ-3 (AI-Powered Documentation Generator)

## Out of Scope (Future Features)
- Collaborative editing (multiple users editing docs)
- Version history (track documentation changes over time)
- Comments/annotations on documentation
- Custom themes/branding
- Documentation analytics (page views, popular sections)
- Integration with documentation hosting platforms (GitBook, ReadTheDocs)

## Success Metrics
- 95% of documentation renders correctly
- Average page load time < 2 seconds
- 70% of users export documentation (download or commit)
- Less than 5% export failures
- 80% user satisfaction with viewer UX

## Notes for Solution Architect
- Consider using Next.js SSG for public documentation (better SEO)
- Implement service worker for offline viewing
- Need efficient markdown parsing (avoid re-parsing on every render)
- Consider using Web Workers for syntax highlighting (avoid blocking UI)
- Plan for documentation versioning in future (track changes)
